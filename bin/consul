#!/bin/bash -e
BASEDIR=$(readlink -f "$(dirname "$0")")
STACK="${1}"
METHOD="$2"
path="$3"
shift 3

if [ -z "$STACK" ]; then
    echo "usage: $BASEDIR/consul STACK GET|PUT|POST|DELETE CONSUL_PATH [ARGS]" >&2
    exit 1
fi

CERTDIR="$HOME/.swarmer/$STACK"
curl --fail \
     --cacert "$CERTDIR/ca.pem" \
     --cert "$CERTDIR/cert.pem" \
     --key "$CERTDIR/key.pem" \
     -"X$METHOD" "https://consul.service.$STACK:8500$path" "$@"
